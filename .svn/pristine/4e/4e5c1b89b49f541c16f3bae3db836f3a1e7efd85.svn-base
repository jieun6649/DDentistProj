<%@ page language="java" contentType="text/html;charset=UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>

<style>
.row .hospitalRow {
	margin: 20px;
}

.row .zip {
	margin-top: 10px;
	margin-left: 20px;
	margin-right: 20px;
}

body, input[type="button"] {
	font-family: bookman old style;
	font-size: 12pt;
}

table {
	border-collapse: collapse;
	margin: auto;
}

th, td {
	border: 1px solid indianred;
	padding: 6px;
}

input[type="text"] {
	border: 1px solid blue;
}

input[type="button"] {
	border: 2px solid indianred;
	background: antiquewhite;
	cursor: pointer;
	margin-top: 20px;
}

input[type="button"]:hover {
	background: indianred;
	color: antiquewhite;
}
</style>

<!--  ë‹¤ìŒ ì£¼ì†Œapi -->
<script src="https://ssl.daumcdn.net/dmaps/map_js_init/postcode.v2.js"></script>

<script type="text/javascript">
// ë‹¤ìŒ ì£¼ì†Œì°¾ê¸° API
function openHomeSearch() {
    new daum.Postcode({
        // ì„ íƒ ì™„ë£Œ ì‹œ ë°ì´í„°ë¥¼ í¼ì— ë‹´ì•„ì¤€ë‹¤.
        oncomplete : function(data) {
            document.HospitalInfoFrm.hiZip.value = data.zonecode; // ìš°í¸ë²ˆí˜¸
            document.HospitalInfoFrm.hiAddr.value = data.address; // ì£¼ì†Œ
            document.HospitalInfoFrm.hiDaddr.value = data.buildingName; // ê±´ë¬¼ì£¼ì†Œ
        }
    }).open();
}

// ì²´ì–´ê´€ë¦¬- ì²´ì–´ ì¶”ê°€
function addRow() {

	  // í…œí”Œë¦¿ ê°€ì ¸ì˜¤ê¸°
	  const template = document.querySelector('#rowTemplate');
	  
	  // ì¶”ê°€í•  í…Œì´ë¸” ê°€ì ¸ì˜¤ê¸°
	  const tbl = document.querySelector('#myTable');
	  
	  // ì™¼ìª½ ìˆ«ì í‘œì‹œ ì„¤ì •
	  const td_slNo = template.content.querySelectorAll("td")[1];
	  const tr_count = tbl.rows.length;
	  td_slNo.textContent = tr_count;
	  
	  // í…œí”Œë¦¿ì˜ content ì†ì„±ê³¼ ê·¸ì˜ ìì‹ ëª¨ë“  ìš”ì†Œë¥¼ ë³µì‚¬
	  const clone = template.content.cloneNode(true); 
	  
	  // ê¸°ì¡´ í…Œì´ë¸”ì— ë³µì‚¬í•œ í…œí”Œë¦¿ì„ ì¶”ê°€
	  tbl.appendChild(clone);

	}


// function add_textBox(){{

// 	// input type="text" ê°€ì ¸ì˜¤ê¸°
// 	const inputBox = document.getElementsByClassName("TdTextTemplate");
// 	console.log("inputBox", inputBox)
// 	var newText = document.createElement('input');
// 	newText.innerHTML = "<input type='text'> <input type='button' value='ì‚­ì œ' onclick='remove(this)'>";
// 	inputBox.appendCild(newText);
	
// }

$(document).ready(function(){
	
	
	$(document).on("change", ".tdSelected", function(){
		
		// ì²´í¬ë°•ìŠ¤ í™œì„±í™”í–ˆì„ ì‹œ
		if($(this).is(":checked")){
			//alert("ì²´í¬");
			
			//parents(í•´ë‹¹ ìš”ì†Œì˜ ìœ„ì—ìˆëŠ” ë¶€ëª¨ë“¤ ì¤‘ <tr>ìš”ì†Œë¥¼ ì°¾ê³  ì°¾ì€ <tr>ìš”ì†Œì˜ ìì‹ ì¤‘ .updateInput í´ë˜ìŠ¤ì´ë¦„ì„ ê°€ì§„ ìš”ì†Œì˜ styleì„ ë³€ê²½ )
			//parent(í•´ë‹¹ ìš”ì†Œì˜ ë°”ë¡œ ìœ„ì—ìˆëŠ” ë¶€ëª¨ë¥¼ ì°¾ì•„ <tr>ìš”ì†Œë¥¼ ì°¾ê³  ì°¾ì€ <tr>ìš”ì†Œì˜ ìì‹ ì¤‘ .updateInput í´ë˜ìŠ¤ì´ë¦„ì„ ê°€ì§„ ìš”ì†Œì˜ styleì„ ë³€ê²½ )
			//children(í•´ë‹¹ ìš”ì†Œì˜ ì•„ë˜ì— ìˆëŠ” ìì‹ë“¤ ì¤‘ <tr>ìš”ì†Œë¥¼ ì°¾ê³  ì°¾ì€ <tr>ìš”ì†Œì˜ ìì‹ ì¤‘ .updateInput í´ë˜ìŠ¤ì´ë¦„ì„ ê°€ì§„ ìš”ì†Œì˜ styleì„ ë³€ê²½)
			//child(í•´ë‹¹ ìš”ì†Œì˜ ë°”ë¡œ ì•„ë˜ì— ìˆëŠ” ìì‹ì„ ì°¾ì•„ <tr>ìš”ì†Œë¥¼ ì°¾ê³  ì°¾ì€ <tr>ìš”ì†Œì˜ ìì‹ ì¤‘ .updateInput í´ë˜ìŠ¤ì´ë¦„ì„ ê°€ì§„ ìš”ì†Œì˜ styleì„ ë³€ê²½)
		
// 			$(this).parent().find(".updateInput").attr("readonly", false); //ì²´ì–´ëª…
			$(this).parent().next().next().find(".updateInput").prop("readonly", false); //ì²´ì–´ëª…
			$(this).parent().next().next().find(".updateInput").css("border", "1px solid blue"); //ì²´ì–´ëª… ì‘ì„±ë€ í…Œë‘ë¦¬
			$(this).parent().parent().find("#chairSn").prop("disabled", false); //ë¶€ì„œ ì„ íƒë€ ì‘ì„±ê°€ëŠ¥ ì²˜ë¦¬
			
			
// 			const newText = document.createElement('input');
// 			newText.innerHTML = "<input type='text'>";
// 			$(".update1").appendCild(newText);
		}else{
			//alert("ì²´í¬í•´ì œ");
// 			$("#chairSn").prop("disabled", true);
// 			$(".updateInput").attr("readonly", true); 
			$(this).parent().next().next().find(".updateInput").prop("readonly", true);
			$(this).parent().next().next().find(".updateInput").css("border", "none");
			$(this).parent().parent().find("#chairSn").prop("disabled", true);
		}
	})
	

});


// ì²´ì–´ê´€ë¦¬- ì²´ì–´ ìˆ˜ì •
function updateRow(){
	
// 	var total_cnt=0;
// 	var tdArr = new Array();
	var checkbox = $("input[name=user_CheckBox]:checked");
	
	//ì²´í¬ëœ ì²´í¬ë°•ìŠ¤ ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
	checkbox.each(function(i){
		
		//ë°©ë²•1)
		/* var tr = checkbox.parent().parent().eq(i); // tr
		var td = tr.children(); // trì˜ ìì‹ìš”ì†Œë“¤
		
		//ì²´í¬ëœ rowì˜ ëª¨ë“  ê°’ì„ ë°°ì—´ì— ë‹´ëŠ”ë‹¤.
	
		//td.eq(0)ì€ ì²´í¬ë°•ìŠ¤ ì´ë¯€ë¡œ td.eq(1)ì˜ ê°’ë¶€í„° ê°€ì ¸ì˜¨ë‹¤.
		var no = td.eq(1).text();
		var chairNm = td.eq(2).find(".updateInput").data("chair");
		var deptCnt = td.eq(3).find("#chairSn").data("dept");
		
		//ê°€ì ¸ì˜¨ ê°’ì„ ë°°ì—´ì— ë‹´ëŠ”ë‹¤.
		tdArr.push(no);
		tdArr.push(chairNm);
		tdArr.push(deptCnt);
		console.log("tdArr: " + tdArr	);
		
		var jsonimg = JSON.stringify(tdArr);//jsonìœ¼ë¡œ ë°”ê¿ˆ */

		//ë°©ë²•2)
		var a = {};
		
		var tr = checkbox.parent().parent().eq(i); // tr
		var td = tr.children(); // trì˜ ìì‹ìš”ì†Œë“¤
		
		//ì²´í¬ëœ rowì˜ ëª¨ë“  ê°’ì„ ë°°ì—´ì— ë‹´ëŠ”ë‹¤.
	
		//td.eq(0)ì€ ì²´í¬ë°•ìŠ¤ ì´ë¯€ë¡œ td.eq(1)ì˜ ê°’ë¶€í„° ê°€ì ¸ì˜¨ë‹¤.
		a.no = td.eq(1).text();
		a.chairNm = td.eq(2).find(".updateInput").data("chair");
		a.deptCnt = td.eq(3).find("#chairSn").data("dept");
		
		let data = a;
		
		console.log(JSON.stringify(data));
		
		$.ajax({
			url : '/hospital/manage/hosInfo/updateChair',
			type : 'post',
			data : JSON.stringify(data),
			beforeSend: function(xhr){
				xhr.setRequestHeader('X-CSRF-TOKEN', '${_csrf.token}');
			}, 
			success : function(res){
				console.log("res : " + res);
			}
			
			
		});
		
	})
}
	
		
// 		// ìˆ˜ì •í•  í…Œì´ë¸” ê°€ì ¸ì˜¤ê¸°
// 		const tbl = document.querySelector('#myTable');
// 		const rows = $(".tdSelected").is(":checked").val();
// 		console.log("rows : " + rows);
// 		// ìˆ˜ì •í•  í…Œì´ë¸”ì˜ ë°ì´í„°ê°’ ëª¨ë‘ ê°€ì ¸ì˜¤ê¸°
// 		for(let i = 1; i < tbl.rows.length; i++){
// 			let serNo = tbl.rows[i].cells[1].innerText;
// 			console.log("serNo :" + serNo)
			
// 		}
// 	}
	


</script>

<div class="content-wrapper"
	style="background-color: rgb(101, 125, 150); min-height: 1001px;">
	<!-- main ê²€ìƒ‰ì°½ì„ í¬í•¨í•œ navbar ì‹œì‘-->
	<nav class="navbar navbar-expand navbar-white navbar-light"
		style="background-color: #404b57;">
		<div class="dropdown">
			<input type="text" class="form-control" id="ptSearch"
				placeholder="ì§ì› ê²€ìƒ‰" onkeyup="searchPatient(this);"
				style="width: 400px;">
			<ul id="ptSearchDropdown" class="dropdown-menu">
		</div>
		<img src="/resources/images/memo_icon.png" alt="ë³‘ì› ë¡œê³ " id="memo"
			class="brand-image elevation-1" style="margin-left: 15px;">

		<div class="collapse navbar-collapse" id="navbarTogglerDemo03"
			style="margin-left: 50%;">
			<ul class="navbar-nav me-auto mb-2 mb-lg-0">
				<li class="nav-item"><a class="nav-link active"
					aria-current="page" href="#" data-toggle="tab"
					style="color: white;">ì§ì›ê´€ë¦¬</a></li>
				<li class="nav-item"><a class="nav-link" href="/hospital/drug"
					style="color: white;">ì•½í’ˆ ê´€ë¦¬</a></li>
				<li class="nav-item"><a class="nav-link"
					href="/hospital/txCode" style="color: white;">ì²˜ì¹˜ ê´€ë¦¬</a></li>
				<li class="nav-item"><a class="nav-link" href="#"
					style="color: white;">ë³‘ì› ê¸°ì´ˆ ì •ë³´</a></li>
			</ul>
		</div>
	</nav>
	<!-- main ê²€ìƒ‰ì°½ì„ í¬í•¨í•œ navbar ë -->

	<div class="SaveRow">
		<input type="button" id="save"
			style="float: right; margin-right: 15px;" value="ë³‘ì›ì •ë³´ ì €ì¥" />
	</div>
	<section class="content" style="margin-top: 3%;">
		<div class="row">
			<!-- ì¢Œì¸¡ ìƒë‹¨ -->
			<div class="col-md-6">
				<div class="card card-info">

					<div class="card-header"
						style="background-color: #404b57; border: none;">
						<div class="d-flex justify-content-between align-items-center">
							<h2 class="card-title">ë³‘ì›ê¸°ì´ˆì •ë³´</h2>
						</div>
					</div>

					<form id="HospitalInfoFrm" name="HospitalInfoFrm"
						action="/hospital/manage/hosInfo/updatePost?_csrf=c55060cc-7bb5-4cff-abfe-6fb41371409c"
						method="post" enctype="multipart/form-data">
						<div class="card-body" style="height: auto;">
							<p>ë³‘ì›ê¸°ë³¸ì •ë³´</p>
							<hr>
							<div class="row">
								<div class="col-md-8">
									<div class="row hospitalRow">
										<div class="col-md-4">
											<label for="hiBrno">ë³‘ì›ëª…</label>
										</div>
										<div class="col-md-8">
											<!--ë³‘ì›ëª… ì…ë ¥ì¹¸ -->
											<input type="text" class="form-control" id="hiBrno"
												name="hiBrno" value="${hosInfo.hiNm}" required>
										</div>
									</div>
									<div class="row hospitalRow">
										<div class="col-md-4">
											<label for="hiType">ë³‘ì› êµ¬ë¶„</label>
										</div>
										<div class="col-md-8">
											<select class="" id=hiType name="hiType">
												<option value="">ì „ì²´</option>
												<c:forEach var="hiType" items="${requestScope.hiTyeList}">
													<option value="${hiType.commCdNm}"
														<c:if test='${hosInfo.hiType == hiType.commCdNm}'>selected</c:if>>${hiType.commCdCnt}</option>
												</c:forEach>
											</select><br />
										</div>
									</div>
									<div class="row hospitalRow">
										<div class="col-md-4">
											<label for="hiBrno">ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸</label>
										</div>
										<div class="col-md-8">
											<!-- ì‚¬ì—…ì ë“±ë¡ë²ˆí˜¸ -->
											<input type="text" class="form-control" id="hiBrno"
												name="hiBrno" value="${hosInfo.hiBrno}"
												pattern="[0-9]{3}-[0-9]{2}-[0-9]{5}" required> <small>Format:
												123-45-6789</small>
										</div>
									</div>
								</div>
								<!-- col-md-8 ë -->
								<div class="col-md-4" style="margin-top: 15px;">
									<label>ë³‘ì›ëŒ€í‘œ ë„ì¥</label>
									<table border="1px;">
										<tbody>
											<tr height="200px;">
												<td width="140px;">
													<div class="col-lg-5 d-none d-lg-block bg-register-image">
														<img id="empImg"
															src="/resources/images/employee/s_cb8450a3-35e9-44e1-9598-730c60f5cb54_user.png"
															onerror="this.src='/resources/images/employee/s_cb8450a3-35e9-44e1-9598-730c60f5cb54_user.png'">
													</div>
												</td>
											</tr>
											<!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ì‹œì‘-->
											<div class="imgs_wrap"></div>
											<!-- ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ë-->
											<input type="file" class="d-none" id="input_imgs" name="file" />
										</tbody>
									</table>
									<input type="file" name="uploadFile" id="file"
										style="margin-top: 10px;">

								</div>
							</div>

							<p>ë“±ë¡ì •ë³´</p>
							<hr>
							<div class="row hospitalRow">
								<div class="col-md-6">
									<!-- ì „í™”ë²ˆí˜¸ -->
									<label for="empId">ì „í™”ë²ˆí˜¸</label> <input type="tel"
										class="form-control" id="HI_BRNO" name="HI_BRNO"
										value="${hosInfo.hiPhone}"
										pattern="[0-9]{3}-[0-9]{3}-[0-9]{5}" required> <small>Format:
										02-463-6789</small>
								</div>
								<div class="col-md-6">
									<!-- íŒ©ìŠ¤ë²ˆí˜¸ -->
									<label for="empId">íŒ©ìŠ¤ë²ˆí˜¸</label> <input type="tel"
										class="form-control" id="HI_BRNO" name="HI_BRNO"
										value="${hosInfo.hiFax}" pattern="[0-9]{3}-[0-9]{3}-[0-9]{5}"
										required> <small>Format: 02-123-4567</small>
								</div>
							</div>
							<div class="row hospitalRow">
								<div class="col-md-6">
									<label for="email">email</label> <input type="email"
										class="form-control" id="hiEml" name="hiEml"
										value="${hosInfo.hiEml}" pattern=".+@globex\.com" size="30"
										required>
								</div>
								<div class="col-md-6">
									<label for="url">í™ˆí˜ì´ì§€</label> <input type="url"
										class="form-control" name="hiHp" id="hiHp"
										value="${hosInfo.hiHp}" placeholder="https://example.com"
										pattern="https://.*" size="30" required>
								</div>
							</div>
							<div class="row zip">
								<div class="col-md-6">
									<!-- ìš°í¸ë²ˆí˜¸ -->
									<label for="hiZip">ì£¼ì†Œ</label> <input type="text"
										class="form-control" id="hiZip" name="hiZip"
										value="${hosInfo.hiZip}" required>
								</div>
								<div class="col-md-6">
									<!-- ìš°í¸ë²ˆí˜¸ ê²€ìƒ‰ -->
									<label> </label>
									<button type="button" class="btn btn-success btn-block btnCss"
										style="background-color: #904aff; border: none; height: 50%; float: right;"
										onclick="openHomeSearch();">ì£¼ì†Œê²€ìƒ‰</button>
								</div>
							</div>
							<div class="row zip">
								<div class="col-md-12">
									<input type="text" class="form-control" id="hiAddr"
										name="hiAddr" placeholder="ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
										value="${hosInfo.hiAddr}" required="">
								</div>
							</div>
							<div class="row zip">
								<div class="col-md-12">
									<input type="text" class="form-control" id="hiDaddr"
										name="hiDaddr" placeholder="ìƒì„¸ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”"
										value="${hosInfo.hiDaddr}" required="">
								</div>
							</div>
						</div>
				</div>
				<!-- 				<sec:csrfinput> -->
				<!-- 			</sec:csrfinput> -->
			</div>

			<!-- ìš°ì¸¡ -->
			<div class="col-md-6">

				<div class="card card-info">

					<div class="card-header"
						style="background-color: #404b57; border: none;">
						<div class="d-flex justify-content-between align-items-center">
							<h2 class="card-title">ëŒ€í‘œì ì •ë³´</h2>
						</div>
					</div>

					<div class="card-body">
						<div class="row hospitalRow">
							<div class="col-md-6">
								<!-- ëŒ€í‘œìëª… -->
								<label for="hiRprsvNm">ëŒ€í‘œìëª…</label> <input type="text"
									class="form-control" id="hiRprsvNm" name="hiRprsvNm"
									value="${hosInfo.hiRprsvNm}" required>
							</div>
							<div class="col-md-6">
								<!-- ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸ -->
								<label for="hiRprsvRrno">ëŒ€í‘œì ì£¼ë¯¼ë“±ë¡ë²ˆí˜¸</label> <input type="text"
									class="form-control" id="hiRprsvRrno" name="hiRprsvRrno"
									value="${hosInfo.hiRprsvRrno}" required>
							</div>
						</div>



					</div>
				</div>
				<!-- ìš°ì¸¡ ì¤‘ì•™ -->
				<div class="card card-info">

					<div class="card-header"
						style="background-color: #404b57; border: none;">
						<div class="d-flex justify-content-between align-items-center">
							<h2 class="card-title">ë³‘ì› ìš´ì˜ì •ë³´</h2>
						</div>
					</div>

					<div class="card-body">
						<div class="row hospitalRow">
							<div class="col-md-4">
								<label>Office hours</label>
							</div>
							<div class="col-sm-4">
								<input type="time" class="form-control" id="hiOpenTime"
									name="hiOpenTime" min="09:00:00" max="18:00:00"
									value="${hosInfo.hiOpenTime}" required>
							</div>
							<div class="col-sm-4">
								<input type="time" class="form-control" id="hiCloseTime"
									name="hiCloseTime" min="09:00" max="18:00"
									value="${hosInfo.hiCloseTime}" required>
							</div>
						</div>
						<div class="row hospitalRow">
							<div class="col-md-4">
								<label>ë³‘ì› íœ´ì‹ì‹œê°„</label>
							</div>
							<div class="col-sm-4">
								<input type="time" class="form-control" id="hiLunchStime"
									name="hiLunchStime" min="09:00" max="18:00"
									value="${hosInfo.hiLunchStime}" required>
							</div>
							<div class="col-sm-4">
								<input type="time" class="form-control" id="hiLunchEtime"
									name="hiLunchEtime" min="09:00" max="18:00"
									value="${hosInfo.hiLunchEtime}" required>
							</div>
						</div>
					</div>
				</div>

				<!-- ìš°ì¸¡ í•˜ë‹¨ -->
				<div class="card card-info">

					<div class="card-header"
						style="background-color: #404b57; border: none;">
						<div class="d-flex justify-content-between align-items-center">
							<h4 class="card-title">ì²´ì–´ ê´€ë¦¬</h4>
						</div>
					</div>
					<!-- 					https://inpa.tistory.com/1093#datalist_%ED%83%9C%EA%B7%B8 -->
					<div class="card-body">
						<form name="myTable" action="" method="post">
							<div class="card-body"
								style="max-height: 317px; overflow-y: auto;">
								<table class="table table-bordered" id="myTable">
									<thead>
										<tr>
											<th style="width: 10px">ğŸ› </th>
											<th>No.</th>
											<!-- ìë™ìƒì„± -->
											<th>ì²´ì–´ëª…</th>
											<!-- ì§ì ‘ ì…ë ¥ -->
											<th>ë¶€ì„œ</th>
											<!-- ì§ì ‘ ì…ë ¥ -->
										</tr>
									</thead>
									<tbody>
										<c:forEach var="chair" items="${requestScope.chairList}"
											varStatus="stat">
											<tr id="tr1">
												<td id="td1"><input type="checkbox" class="tdSelected"
													name="user_CheckBox" id="tdSelected" /></td>
												<td id="td2">${chair.chairSn}</td>
												<td id="td3"><input type="text"
													data-chair="${chair.chairNm}" class="updateInput"
													value="${chair.chairNm}" style="border: none;" readonly /></td>
												<td id="td4"><select id="chairSn" name="chairSn"
													data-dept="${chair.deptCd}" disabled>
														<option value="">ì§„ë£Œì‹¤ ì„ íƒ</option>
														<c:forEach var="dept" items="${requestScope.deptList}">
															<option value="${dept.deptCd}"
																<c:if test='${dept.deptCd == chair.deptCd}'>selected</c:if>>${dept.deptNm}</option>
														</c:forEach>
												</select></td>
											</tr>
										</c:forEach>
									</tbody>
								</table>



								<!-- ë²„íŠ¼ í´ë¦­í•˜ë©´ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ -->
								<input type="button" value="New Row" onclick="addRow()">

								<!-- ì €ì¥ í´ë¦­í•˜ë©´ ìë°”ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ -->
								<input type="button" value="Update Row" onclick="updateRow()">

								<!-- í…Œì´ë¸”ì— ì¶”ê°€í•  í…Œì´ë¸” ë‚´ë¶€ í…œí”Œë¦¿ -->
								<template id="rowTemplate">
									<tr class="TrTemplate">
										<td><input type="checkbox"></td>
										<td></td>
										<td class="TdTextTemplate"><input type="text" /></td>
										<td class="TdSelectTemplate"><select id="chairSn"
											name="chairSn">
												<option value="">ì§„ë£Œì‹¤ ì„ íƒ</option>
												<c:forEach var="dept" items="${requestScope.deptList}">
													<option value="${dept.deptCd}"
														<c:if test='${deptCd == dept.deptCd}'>selected</c:if>>${dept.deptNm}</option>
												</c:forEach>
										</select></td>
									</tr>
								</template>



							</div>
						</form>
					</div>
				</div>
			</div>
			</form>
		</div>
	</section>
</div>