<%@ page language="java" contentType="text/html; charset=utf-8" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>

<!-- 풀캘린더 css 시작 -->
<link rel="stylesheet" href="/resources/fullcalendar/vendor/css/fullcalendar.min.css" />
<link rel="stylesheet" href="/resources/fullcalendar/vendor/css/bootstrap.min.css" />
<link rel="stylesheet" href='/resources/fullcalendar/vendor/css/select2.min.css' />
<link rel="stylesheet" href='/resources/fullcalendar/vendor/css/bootstrap-datetimepicker.min.css' />
<link rel="stylesheet" href="/resources/fullcalendar/css/main.css" />
<!-- 풀캘린더 css 끝 -->

<style>
body{
	font-size:inherit;
}

.cardbodyCss{
	overflow:scroll; 
	height: 400px; 
	font-size:14px;
	overflow-x:hidden;
}
.cardbodyCss::-webkit-scrollbar{
	width: 10px;
	height: 10px;
}
.cardbodyCss::-webkit-scrollbar-thumb{
    background-color: #404b57;
    border-radius: 5px;
}
.cardbodyCss::-webkit-scrollbar-track{
    background-color: rgba(0,0,0,0);
} 
.dropdown-item{
	cursor: pointer;
}
#ptDetailCard::-webkit-scrollbar{
	display: none;
}
#waitingList::-webkit-scrollbar{
	width: 10px;
	height: 10px;
}
#waitingList::-webkit-scrollbar-thumb{
    background-color: #404b57;
    border-radius: 5px;
}
#waitingList::-webkit-scrollbar-track{
    background-color: rgba(0,0,0,0);
} 
td[data-toggle="dropdown"]{
	cursor: pointer;
}
/* 진료목록 헤더 */
.tableHead {
	position: sticky;
	top: -0.1px;
	background-color: whitesmoke;
}

/* 풀캘린더 적용 이후 */
.form-horizontal{
	height : 144px;
}
</style>
<div class="content-wrapper" style="background-color: #657D96;">
	<!-- main 검색창을 포함한 navbar 시작-->
	<nav class="navbar navbar-expand navbar-white navbar-light" style="background-color: #404b57;">

		<div class="dropdown">
			<input type="text" class="form-control" id="ptSearch" placeholder="환자 검색" onkeyup="searchPatient(this);" style="width: 400px;" autocomplete="off" />
			<ul id="ptSearchDropdown" class="dropdown-menu">
			</ul>
		</div>
		<img src="/resources/images/layout/hospital/memo_icon.png" alt="메모" id="memo" class="brand-image elevation-1" style="margin-left: 15px;">

		<ul class="navbar-nav ml-auto">

		</ul>
	</nav>
	<!-- main 검색창을 포함한 navbar 끝 -->
	<section class="content" style="margin-top: 1%;">
		<!-- 상단 row 시작 -->
		<div class="row">
			<!-- 좌측 상단 -->
			<div class="col-md-6" style="padding-right:0px;">
				<div class="card card-info">

					<div class="card-header" style="background-color: #404b57; border: none;">
						<div class="d-flex justify-content-between align-items-center">
							<h2 class="card-title">환자 정보</h2>
							<div>
								<button type="button" class="btn btn-info btnCss" style="background-color: #904aff; border: #904aff;" onclick="resetForm();">신환등록</button>
								<button type="button" class="btn btn-warning btnCss" style="color: white; border: none; background-color: #ff3e3e;" onclick="deletePatient();">환자삭제</button>
							</div>
						</div>
					</div>

					<form name="patientForm" action="/hospital/desk/insertPatient">

						<div class="card-body">

							<div class="form-group row">
								<label for="ptNum" class="col-sm-2 col-form-label">차트번호</label> <input type="text" class="col-sm-2 form-control" name="ptNum" readonly />
								<div class="col-sm-2 pr-0">
									<input type="text" class="form-control" name="ptGen" readonly />
								</div>
								<label for="ptZip" class="col-sm-2 col-form-label">우편번호</label>
								<div class="col-sm-2">
									<input type="text" class="form-control" name="ptZip" readonly />
								</div>
								<div class="col-sm-2">
									<button type="button" class="btn btn-success btn-block btnCss"
											style="background-color: #904aff; border: none; height: 100%;"
											onclick="openHomeSearch();">주소검색</button>
								</div>
							</div>
							<div class="form-group row">
								<label for="name" class="col-sm-2 col-form-label">이름</label>
								<input type="text" class="col-sm-4 form-control" name="ptNm" />
								<label for="ptAddr" class="col-sm-2 col-form-label">주소</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" name="ptAddr" readonly />
								</div>
							</div>
							<div class="form-group row">
								<label for="ptBir" class="col-sm-2 col-form-label">생년월일</label>
								<input type="text" class="col-sm-4 form-control" name="ptBrdt" readonly />
								<label for="ptAddrDet" class="col-sm-2 col-form-label">상세주소</label>
								<div class="col-sm-4">
									<input type="text" class="form-control" name="ptAddrDet" />
								</div>
							</div>
							<div class="form-group row">
								<label for="ptRrn" class="col-sm-2 col-form-label">주민등록번호</label>
								<div class="col-sm-4">
									<div class="row">
										<div class="col-sm-5 p-0">
											<input type="text" class="form-control" name="ptRrno1" />
										</div>
										<div class="col-sm-2 p-0 text-center">
											<span class="align-middle">-</span>
										</div>
										<div class="col-sm-5 p-0">
											<input type="text" class="form-control" name="ptRrno2" />
										</div>
									</div>
								</div>
								<label for="dentist" class="col-sm-2 col-form-label">의사/체어</label>
								<div class="col-sm-4">
									<div class="row">
										<div class="col-sm-6">
											<select id="regDoc" class="custom-select rounded-10">
												<c:forEach var="emp" items="${requestScope.empList}">
													<option value="${emp.empNum}">${emp.empNm}</option>
												</c:forEach>
											</select>
										</div>
										<div class="col-sm-6">
											<select id="chairNum" class="custom-select rounded-10">
												<c:forEach var="chair" items="${requestScope.chairList}">
													<option value="${chair.chairSn}">${chair.chairNm}</option>
												</c:forEach>
											</select>
										</div>
									</div>
								</div>
							</div>
							<div class="form-group row">
								<label for="ptPhone" class="col-sm-2 col-form-label">연락처</label>
								<div class="col-sm-4">
									<div class="row">
										<input type="text" class="col-sm-3 form-control" name="ptPhone1" maxlength="3">
										<div class="col-sm-1 p-0 text-center">
											<span class="align-middle">-</span>
										</div>
										<input type="text" class="col-sm-3 form-control" name="ptPhone2" maxlength="4">
										<div class="col-sm-1 p-0 text-center">
											<span class="align-middle">-</span>
										</div>
										<input type="text" class="col-sm-4 form-control" name="ptPhone3" maxlength="4">
									</div>
								</div>
								<div class="col-sm-2"></div>
								<div class="col-sm-4">
									<div class="form-check">
										<input type="checkbox" name="prvcPvsnAgreYn" value="Y" />
										<label class="form-check-label">개인정보제공 동의</label>
									</div>
									<div class="form-check">
										<input type="checkbox" name="smsRcptnAgreYn" value="Y" />
										<label class="form-check-label">문자수신동의</label>
									</div>
								</div>
							</div>

							<!-- medical alert(기저질환) -->
							<div class="form-group row">
								<div class="input-group">
									<label for="disNM" class="col-sm-2 col-form-label">기저질환</label>
									<div class="col-sm-4 p-0">
										<div class="row">
											<div class="col-sm-4 pr-0">
												<button type="button" class="btn btn-danger btnCss btn-block" id="openQuesBtn"
														onclick="selectQue();" style="background-color: #ff3e3e; height: 100%;" disabled>수정</button>
											</div>
											<div class="col-sm-8">
												<input type="text" class="form-control-plaintext" id="medicalAlerts" readonly />
											</div>
										</div>
									</div>
									<div class="col-sm-2"></div>
									<div class="col-sm-4">
										<div class="form-check">
											<input type="checkbox" name="ptPregYn" value="Y">
											<label class="from-check-label">임신중</label>
										</div>
									</div>
								</div>
							</div>
							<div class="form-group">
								<div class="d-flex justify-content-end align-items-center">
									<button type="button" class="btn btn-success btnCss"
											style="background-color: #904aff; border: none; width: 10%;" onclick="insertPatient();">저장</button>
									<button type="button" class="btn btn-success btnCss ml-1"
											style="background-color: #904aff; border: none; width: 10%;" onclick="insertRegist();">접수</button>
								</div>
							</div>

						</div>

					</form>
				</div>
			</div>

			<!-- 오른쪽 상단 -->
			<div class="col-md-6">
				<div class="card card-primary">
					<div class="card-header" style="background-color: #404b57;">
						<div class="d-flex justify-content-between align-items-center">
							<h2 class="card-title">예약 현황</h2>
							<div>
								<button type="button" class="btn btn-info btnCss fc-state-default fc-corner-left fc-corner-right" id="new_reservtaion"
										style="background-color: #904aff; border: #904aff;" onclick="resetForm();" >새예약</button>
							</div>
						</div>
					</div>
					<div class="card-body cardbodyCss">
			        	<div class="calendar" id="calendarDay">
			            </div>
			            
			            <div style="display:none;">
		                    <label for="calendar_view">예약 현황</label>
		                    <div class="input-group">
		                        <select class="filter" id="type_filter" multiple="multiple">
		                            <option value="카테고리1">카테고리1</option>
		                        </select>
		                    </div>
			            	<label for="calendar_view">의사 목록</label>
			            	<label class="checkbox-inline" style="display:inline-block; width:100px;">
	   	                    	<input class="" id="allCheck" type="checkbox" value="all" checked>전체선택
	                        </label>
		                    <div class="input-group" id='doctor'>
	                      	</div>
	                    </div>
	                    
	                    <hr />
	                </div>
				</div>
			</div>
		</div>
		
		<!-- 예약 모달 시작 -->
		<div class="modal fade" tabindex="-1" role="dialog" id="eventModal">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h1 class="modal-title"></h1>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        	<span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">

                        <div class="row">
                            <div class="col-xs-12">
                                <input class='allDayNewEvent' id="edit-allDay" type="hidden" />
                                <input class='inputModal' id="resvId" type="hidden" name="resvId" />
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-xs-12">
                                <label class="col-xs-4" for="ptNm">환자명</label>
                                <input class="inputModal" type="text" name="ptNm" id="ptNm"
                                    placeholder="이름을 입력하세요" required="required" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <label class="col-xs-4" for="ptPhone">전화번호</label>
                                <input class="inputModal" type="text" name="ptPhone" id="ptPhone"
                                    required="required" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <label class="col-xs-4" for="edit_date">진료 날짜</label>
                                <input class="inputModal" type="date" name="edit_date" id="edit_date" />
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <label class="col-xs-4" for="edit_start">진료 시작 시간</label>
<!--                                 <input class="inputModal" type="hidden" name="edit_start" id="edit_start" /> -->
								<select class="inputModal" name="edit_start" id="edit_start">
									<option value="09:00">09:00</option>
									<option value="09:30">09:30</option>
								</select> 
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <label class="col-xs-4" for="edit_end">진료 종료 시간</label>
<!--                                 <input class="inputModal" type="hidden" name="edit_end" id="edit_end" /> -->
								<select class="inputModal" name="edit_end" id="edit_end" >
									<option value="09:30">09:30</option>
									<option value="10:00">10:00</option>
								</select> 
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <label class="col-xs-4" for="empNum">의사</label>
                                <select class="inputModal" name="empNum" id="empNum">
                                    <option value="" style="display:none;">의사를 선택하세요</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-xs-12">
                                <label class="col-xs-4" for="resvCc">호소 증상(C.C)</label>
                                <textarea rows="4" cols="50" class="inputModal" name="resvCc"
                                    id="resvCc"></textarea>
                            </div>
                        </div>
                        <div class="row" id='status_div'>
                            <div class="col-xs-12">
                                <label class="col-xs-4" for="status">예약 상태</label>
                                <input class='inputModal' id="status" type="text" name="status" readonly />
<!--                                 <div class="inputModal" id="status">예약 진행중</div> -->
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer modalBtnContainer-addEvent">
                        <button type="button" class="btn btn-default" data-dismiss="modal">취소</button>
                        <button type="button" class="btn btn-primary" id="save-event">저장</button>
                    </div>
                    <div class="modal-footer modalBtnContainer-resvEvent">
                        <button type="button" class="btn btn-default" data-dismiss="modal" id='modalClose'>닫기</button>
                        <!-- 예약중일경우  -->
                        <button type="button" class="btn btn-primary" id="implResv" value="IMPL_RESV">예약 이행</button>
                        <button type="button" class="btn btn-danger" id="cancelResv" value='CANCEL_RESV'>예약 취소</button>
                    	<!-- 예약 이행중일 경우  -->
                        <button type="button" class="btn btn-warning" id="inResv" value='IN_RESV'>예약 이행 취소</button>
<!--                         <button type="button" class="btn btn-primary" id="updateEvent">저장</button> -->
                    </div>
                </div><!-- /.modal-content -->
            </div><!-- /.modal-dialog -->
        </div><!-- /.modal -->
		<!-- 예약 모달 끝 -->
		
		<!-- 상단 row 끝 -->
		
		
		
		<!-- 하단 row 시작 -->
		<div class="row">
			<!-- 하단 좌측  C.C & 메모 시작 -->
			<div class="col-md-2 pr-0">
				<div class="card card-info">
					<div class="card-header" style="background-color: #404b57;">
						<h3 class="card-title">C.C</h3>
					</div>
					<form class="form-horizontal">
						<div class="card-body" style="border-bottom: 20px;">
							<div class="form-group row">
								<textarea id="regCc" class="form-control" rows="3" placeholder="C.C"></textarea>
							</div>
						</div>
					</form>
				</div>

				<div class="card card-info">
					<div class="card-header" style="background-color: #404b57;">
						<h3 class="card-title">메모</h3>
					</div>
					<form class="form-horizontal">
						<div class="card-body" style="border-bottom: 20px;">
							<div class="form-group row">
								<textarea class="form-control" rows="3" id="ptMemo" placeholder="메모"></textarea>
							</div>
						</div>
					</form>
				</div>
				<!-- 하단 좌측  C.C & 메모 끝 -->
			</div>

			<!-- tab을 포함한 card(가족,진료,수납) 시작 -->
			<div class="col-sm-4 pr-0">
				<div class="card card-primary card-tabs">
					<div class="card-header p-0 pt-1" style="background-color: #404b57;">
						<ul class="nav nav-tabs" role="tablist" id="ptDetailTabList">
							<li class="nav-item" role="presentation">
								<a class="nav-link active" data-toggle="pill" href="#familyList" role="tab">가족</a>
							</li>
							<li class="nav-item" role="presentation">
								<a class="nav-link" data-toggle="tab" href="#checkupList" role="tab">진료</a>
							</li>
							<li class="nav-item">
								<a class="nav-link" data-toggle="tab" href="#rcvmtList" role="tab">수납</a>
							</li>
						</ul>
					</div>
					<div class="card-body table-responsive p-0" style="height: 350px;">
						<div class="tab-content w-100">
							<div class="tab-pane fade-show active" id="familyList" role="tabpanel">
								<div class="row w-100 m-0">
									<div class="col-sm-12 p-0">
										<table class="table table-bordered table-hover text-center">
											<thead class="tableHead" style="z-index: 20;">
												<tr>
													<th style="width: 20%;">순번</th>
													<th style="width: 25%;">이름</th>
													<th style="width: 35%;">차트번호</th>
													<th style="width: 20%;">관계</th>
												</tr>
											</thead>
											<tbody id="familyListBody"></tbody>
										</table>
									</div>
								</div>
								<div class="p-3 d-flex justify-content-end position-absolute" style="z-index: 20; bottom: 0;">
									<button type="button" class="btn btn-secondary rounded-pill" style="opacity: 70%;"
											onclick="openfamilyModal();">+</button>
								</div>
							</div>
							<div class="tab-pane fade" id="checkupList" role="tabpanel">
								<div class="row w-100 m-0">
									<div class="col-sm-12 p-0">
										<table class="table table-bordered table-hover text-center">
											<thead class="tableHead">
												<tr>
													<th style="width: 50%;">진료번호</th>
													<th style="width: 25%;">진료일</th>
													<th style="width: 25%;">진료의사</th>
												</tr>
											</thead>
											<tbody id="checkupListBody"></tbody>
										</table>
									</div>
								</div>
							</div>
							<div class="tab-pane fade" id="rcvmtList" role="tabpanel">
								<div class="row w-100 m-0">
									<div class="col-sm-12 p-0">
										<table class="table table-bordered table-hover text-center">
											<thead class="tableHead">
												<tr>
													<th style="width: 40%;">수납번호</th>
													<th style="width: 20%;">수납일</th>
													<th style="width: 20%;">진료비</th>
													<th style="width: 20%;">미수금</th>
												</tr>
											</thead>
											<tbody id="rcvmtListBody"></tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- tab을 포함한 card 끝 -->
			<!-- 진료목록 시작 -->
			<div class="col-sm-6">
				<div class="card">
					<div class="card-header" style="background-color: #404b57;">
						<h3 class="card-title" style="color: white;">접수목록</h3>
					</div>

					<div class="card-body table-responsive p-0" style="height: 350px; border-bottom: 20px;" id="waitingList">
						<div id="example2_wrapper" class="dataTables_wrapper dt-bootstrap4">
							<div class="row">
								<div class="col-sm-12">
									<table class="table table-bordered table-hover text-center" style="width: 1600px;">
										<thead class="tableHead" style="z-index: 20;">
											<tr>
												<th style="width: 5%;">순번</th>
												<th style="width: 8%;">상태</th>
												<th style="width: 10%;">차트번호</th>
												<th style="width: 5%;">이름</th>
												<th style="width: 8%;">대기시간</th>
												<th style="width: 8%;">접수시간</th>
												<th style="width: 8%;">예약시간</th>
												<th style="width: 10%;">체어</th>
												<th style="width: 8%;">의사</th>
												<th style="width: 30%;">C.C</th>
											</tr>
										</thead>
										<tbody id="registList">
											<!--                         <tr class="odd"> -->
											<!--                           <td tabindex="0">1</td> -->
											<!--                           <td>진료접수</td> -->
											<!--                           <td>1420</td> -->
											<!--                           <td>정준석님</td> -->
											<!--                           <td>29</td> -->
											<!--                           <td>30분</td> -->
											<!--                           <td>신환</td> -->
											<!--                           <td>10:10</td> -->
											<!--                           <td>10:40</td> -->
											<!--                           <td>박원장</td> -->
											<!--                           <td>상악 사랑니에 비틀림확인,발치요구</td> -->
											<!--                           <td>-</td> -->
											<!--                           <td>윗니가 아파요</td> -->
											<!--                         </tr> -->
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- 진료목록 끝 -->
		</div>
		<!-- 하단 row 끝 -->
	</section>
</div>

<!-- 가족관계 추가 모달 -->
<div class="modal fade" id="familyModal" data-backdrop="static" data-keyboard="false">
	<div class="modal-dialog modal-lg modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="familyModalLabel">가족관계 추가</h5>
				<button type="button" class="close" data-dismiss="modal">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form name="familyPatientForm" action="/hospital/desk/insertFamily">
					<div class="row">
						<div class="col-sm-6 px-4">
							<div class="form-group mb-3 dropdown">
								<label class="form-label">환자 검색</label>
								<input type="text" id="famPtSearch" class="form-control" onkeyup="searchFamPatient(this);" />
								<ul id="famPtSearchDropdown" class="dropdown-menu">
								</ul>
							</div>
							<div class="form-group row m-0">
								<label class="form-label col-sm-4 d-flex justify-content-center align-items-center m-0">차트번호</label>
								<input type="text" name="famPtNum" class="form-control-plaintext col-sm-8" readonly />
							</div>
							<div class="form-group row m-0">
								<label class="form-label col-sm-4 d-flex justify-content-center align-items-center m-0">환자 명</label>
								<input type="text" name="famPtNm" class="form-control-plaintext col-sm-8" readonly />
							</div>
							<div class="form-group row m-0">
								<label class="form-label col-sm-4 d-flex justify-content-center align-items-center m-0">생년월일</label>
								<input type="text" name="famPtBrdt" class="form-control-plaintext col-sm-8" readonly />
							</div>
						</div>
						<div class="col-sm-6 px-4">
							<label class="form-label">관계 선택</label>
							<select class="custom-select" name="famRel">
								<c:forEach var="fam" items="${requestScope.familyCodeList}">
									<option value="${fam.commCdNm}">${fam.commCdCnt}</option>
								</c:forEach>
							</select>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-primary" onclick="insertFamily();">저장</button>
				<button type="button" class="btn btn-secondary" data-dismiss="modal" onclick="resetFamilyModal();">닫기</button>
			</div>
		</div>
	</div>
</div>

<div class="modal fade" id="queModal" data-backdrop="static" data-keyboard="false" tabindex="-1">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="queModalLabel">문진표</h5>
				<button type="button" class="close" data-dismiss="modal">
					<span aria-hidden="true">&times;</span>
				</button>
			</div>
			<div class="modal-body">
				<form name="questionnaireForm">
					<input type="hidden" name="ptNum" />
					<div class="row g-2">
						<div class="form-group col-sm-6">
							<label class="form-label">내원 이유</label>
							<input type="text" class="form-control" name="queReason" />
						</div>
						<div class="form-group col-sm-6">
							<label class="form-label">희망 치료 내용</label>
							<input type="text" class="form-control" name="queWant" />
						</div>
					</div>
					<div class="form-group">
						<label class="form-label">복용 약</label>
						<input type="text" class="form-control" name="quePharm" />
					</div>
					<div>
						<div class="row">
							<div class="form-group col-sm-4">
								<label class="form-label">1.항혈전제 복용</label>
								<input type="checkbox" name="uConList[0].conNm" value="항혈전제 복용" />
								<input type="text" class="uConditionType" name="uConList[0].conDet" disabled />
							</div>
							<div class="form-group col-sm-4">
								<label class="form-label">2.위장장애</label>
								<input type="checkbox" name="uConList[1].conNm" value="위장장애" />
								<input type="text" class="uConditionType" name="uConList[1].conDet" disabled />
							</div>
							<div class="form-group col-sm-4">
								<label class="form-label">3.고혈압</label>
								<input type="checkbox" name="uConList[2].conNm" value="고혈압" />
								<input type="text" class="uConditionType" name="uConList[2].conDet" disabled />
							</div>
						</div>
						<div class="row">
							<div class="form-group col-sm-4">
								<label class="form-label">4.당뇨병</label>
								<input type="checkbox" name="uConList[3].conNm" value="당뇨병" />
								<input type="text" class="uConditionType" name="uConList[3].conDet" disabled />
							</div>
							<div class="form-group col-sm-4">
								<label class="form-label">5.간염</label>
								<input type="checkbox" name="uConList[4].conNm" value="간염" />
								<input type="text" class="uConditionType" name="uConList[4].conDet" disabled />
							</div>
							<div class="form-group col-sm-4">
								<label class="form-label">6.결핵</label>
								<input type="checkbox" name="uConList[5].conNm" value="결핵" />
								<input type="text" class="uConditionType" name="uConList[5].conDet" disabled />
							</div>
						</div>
						<div class="row">
							<div class="form-group col-sm-4">
								<label class="form-label">7.페니실린 알러지</label>
								<input type="checkbox" name="uConList[6].conNm" value="페니실린 알러지" />
								<input type="text" class="uConditionType" name="uConList[6].conDet" disabled />
							</div>
							<div class="form-group col-sm-4">
								<label class="form-label">8.감염성</label>
								<input type="checkbox" name="uConList[7].conNm" value="감염성" />
								<input type="text" class="uConditionType" name="uConList[7].conDet" disabled />
							</div>
							<div class="form-group col-sm-4">
								<label class="form-label">9.내심막염</label>
								<input type="checkbox" name="uConList[8].conNm" value="내심막염" />
								<input type="text" class="uConditionType" name="uConList[8].conDet" disabled />
							</div>
						</div>
						<div class="row">
							<div class="form-group col-sm-4">
								<label class="form-label">10.뇌혈관질환</label>
								<input type="checkbox" name="uConList[9].conNm" value="뇌혈관질환" />
								<input type="text" class="uConditionType" name="uConList[9].conDet" disabled />
							</div>
							<div class="form-group col-sm-4">
								<label class="form-label">11.심장질환</label>
								<input type="checkbox" name="uConList[10].conNm" value="심장질환" />
								<input type="text" class="uConditionType" name="uConList[10].conDet" disabled />
							</div>
							<div class="form-group col-sm-4">
								<label class="form-label">12.만성 신부전(혈액투석)</label>
								<input type="checkbox" name="uConList[11].conNm" value="만성 신부전(혈액투석)" />
								<input type="text" class="uConditionType" name="uConList[11].conDet" disabled />
							</div>
						</div>
						<div class="row">
							<div class="form-group col-sm-4">
								<label class="form-label">13.만성간경화</label>
								<input type="checkbox" name="uConList[12].conNm" value="만성간경화" />
								<input type="text" class="uConditionType" name="uConList[12].conDet" disabled />
							</div>
							<div class="form-group col-sm-4">
								<label class="form-label">14.천식</label>
								<input type="checkbox" name="uConList[13].conNm" value="천식" />
								<input type="text" class="uConditionType" name="uConList[13].conDet" disabled />
							</div>
							<div class="form-group col-sm-4">
								<label class="form-label">15.기타</label>
								<input type="checkbox" name="uConList[14].conNm" value="기타" />
								<input type="text" class="uConditionType" name="uConList[14].conDet" disabled />
							</div>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button type="button" class="btn btn-success" onclick="insertQue();">저장</button>
				<button type="button" class="btn btn-secondary" data-dismiss="modal">닫기</button>
			</div>
		</div>
	</div>
</div>
<script src="https://ssl.daumcdn.net/dmaps/map_js_init/postcode.v2.js"></script>

<!-- 풀캘린더 js 시작 -->
<script src="/resources/fullcalendar/vendor/js/jquery.min.js"></script>
<script src="/resources/fullcalendar/vendor/js/bootstrap.min.js"></script>
<script src="/resources/fullcalendar/vendor/js/moment.min.js"></script>
<script src="/resources/fullcalendar/vendor/js/fullcalendar.min.js"></script>
<script src="/resources/fullcalendar/vendor/js/ko.js"></script>
<script src="/resources/fullcalendar/vendor/js/select2.min.js"></script>
<script src="/resources/fullcalendar/vendor/js/bootstrap-datetimepicker.min.js"></script>
<script src="/resources/fullcalendar/js/main.js"></script>
<script src="/resources/fullcalendar/js/addEvent.js"></script>
<script src="/resources/fullcalendar/js/editEvent.js"></script>
<script src="/resources/fullcalendar/js/etcSetting.js"></script>
<script src="/resources/fullcalendar/js/setting.js"></script>
<script src="/resources/js/alertModule.js"></script>
<!-- 풀캘린더 js 끝 -->

<script>

// 다음 주소찾기 API
function openHomeSearch() {
    new daum.Postcode({
        // 선택 완료 시 데이터를 폼에 담아준다.
        oncomplete : function(data) {
            document.patientForm.ptZip.value = data.zonecode; // 우편번호
            document.patientForm.ptAddr.value = data.address; // 주소
            document.patientForm.ptAddrDet.value = data.buildingName; // 건물주소
        }
    }).open();
}

// 가족관계 모달 열기
function openfamilyModal(){
	const ptNum = document.patientForm.ptNum.value;
	if(ptNum == ''){
		simplePatientSelectNeedAlert();
		return false;
	}
	
	$('#familyModal').modal('show');
}

// 환자의 가족, 진료, 수납 정보를 가져온다.
function selectDetail(){
	
	const ptNum = document.patientForm.ptNum.value;
	if(ptNum == '') return false;
	
	fetch('/hospital/desk/selectDetail?ptNum=' + ptNum)
		.then(res => res.json())
		.then(ptDet => {
			
			// 가족관계 목록 셋팅
			setFamilyList(ptDet.familyList);
			
			// 진료내역 목록 셋팅
			setCheckupList(ptDet.checkupList);
			
			// 수납내역 목록 셋팅
			setRcvmtList(ptDet.rcvmtList);
			
		});
	
}

//진료이력 목록을 불러온 데이터를 사용해 셋팅한다.
function setCheckupList(chkup){
	
	let chkList = '';
	chkup.forEach(function(chk){
		chkList += '<tr>';
		chkList += '<td>' + chk.chkNum + '</td>';
		chkList += '<td>' + chk.chkDtStr + '</td>';
		chkList += '<td>' + chk.empNm + '</td>';
		chkList += '</tr>';
	});
	
	document.querySelector('#checkupListBody').innerHTML = chkList;
	
}

//수납이력 목록을 불러온 데이터를 사용해 셋팅한다.
function setRcvmtList(rcvmt){
	
	let rcvmtList = '';
	rcvmt.forEach(function(rcv){
		rcvmtList += '<tr>';
		rcvmtList += '<td>' + rcv.rcvmtNum + '</td>';
		rcvmtList += '<td>' + rcv.rcvmtDtStr + '</td>';
		rcvmtList += '<td>' + rcv.rcvmtGramt.toLocaleString() + '</td>';
		rcvmtList += '<td>' + rcv.rcvmtBalance.toLocaleString() + '</td>';
		rcvmtList += '</tr>';
	});
	
	document.querySelector('#rcvmtListBody').innerHTML = rcvmtList;
	
}

// 환자 상세정보의 탭을 클릭하여 탭 내용을 바꾼다.
$('#ptDetailTabList a').on('click', function(){
	$(this).tab('show');
});

// 환자 검색란에 값 입력 시 드롭박스 메뉴가 열린다.
$('#famPtSearch').on('keyup', function(e){
	$(this).dropdown('toggle');
});

// 환자 검색란을 떠나면 드롭박스 메뉴가 닫힌다.
$('#famPtSearch').on('blur', function(e){
	if($('#famPtSearchDropdown').hasClass('show')){
		$('#famPtSearchDropdown').removeClass('show');
	}
});

// 가족관계 추가를 위해 환자를 검색한다.
function searchFamPatient(target){
	
	const keyword = target.value;
	if(keyword.trim() == '') return false;
	
	fetch('/hospital/desk/searchPatient?keyword=' + keyword)
		.then(res => res.json())
		.then(ptList => {

			let dropdownItems = '';
			ptList.forEach(function(pt){
				dropdownItems += '<li class="dropdown-item" data-num="' + pt.ptNum + '" data-nm="' + pt.ptNm + '" data-brdt="' + pt.ptBrdt + '" onmousedown="selectFamPt(this);">' + pt.ptNm + '(' + pt.ptNum + ')' + '</li>';
			});
			
			document.querySelector('#famPtSearchDropdown').innerHTML = dropdownItems;
		});
	
}

// 검색 목록에서 가족 환자를 선택하면 가족관계 폼이 채워진다.
function selectFamPt(target){
	
	document.familyPatientForm.action = '/hospital/desk/insertFamily';
	document.querySelector('#famPtSearch').value = target.dataset.nm + '(' + target.dataset.num + ')';
	document.familyPatientForm.famPtNum.value = target.dataset.num;
	document.familyPatientForm.famPtNm.value = target.dataset.nm;
	document.familyPatientForm.famPtBrdt.value = target.dataset.brdt;
	
}

// 가족관계 추가
function insertFamily(){
	
	let familyFormData = new FormData(document.familyPatientForm);
	
	if(familyFormData.get('famPtNum') == ''){
		simpleErrorAlert('환자를 선택해주세요.');
		return false;
	}
	
	if(actionPath.indexOf('insertFamily') != -1){
		const famPtNum = familyFormData.get('famPtNum');
		if(checkAlreadyFamily(famPtNum)) {
			simpleErrorAlert('이미 가족관계인 환자입니다.');
			return false;
		}
	}
	
	const actionPath = document.familyPatientForm.action;
	familyFormData.append('ptNum', document.patientForm.ptNum.value);
	
	const csrfToken = $('#_csrfToken').val();
	
	fetch(actionPath + '?_csrf=' + csrfToken, {
		method: 'post',
		body: familyFormData
	})
		.then(res => res.text())
		.then(text => {
			if(text == 'FAILED'){
				simpleJustErrorAlert();
				return false;
			}
			
			if(text == 'INSERT'){
				simpleSuccessAlert('가족관계가 추가되었습니다.');
			} else if (text == 'UPDATE'){
				simpleSuccessAlert('가족관계가 수정되었습니다.');
			}
			
			$('#familyModal').modal('hide');
			resetFamilyModal();
			listFamily();
		});
}

// 이미 가족관계인 환자인지 확인
function checkAlreadyFamily(famPtNum){
	
	let famListTr = document.querySelectorAll('#familyListBody tr');
	const famPtNumList = [...famListTr].map(tr => {
		return tr.childNodes[2].textContent.trim();
	});
	
	if(famPtNumList.includes(famPtNum)) return true;
	return false;
}

// 가족관계 목록 조회
function listFamily(){
	
	const familyListBody = document.querySelector('#familyListBody');
	
	const ptNum = document.patientForm.ptNum.value;
	
	fetch('/hospital/desk/listFamily?ptNum=' + ptNum)
		.then(res => res.json())
		.then(famPt => {
			setFamilyList(famPt);
		});
	
}

// 가족관계 수정 모달
function openFamilyModalUpdate(famPtNum){
	
	const ptNum = document.patientForm.ptNum.value;
	
	fetch('/hospital/desk/selectFamily?ptNum=' + ptNum + '&famPtNum=' + famPtNum)
		.then(res => res.json())
		.then(famPt => {
			
			document.familyPatientForm.action = '/hospital/desk/updateFamily';
			
			document.querySelector('#famPtSearch').value = famPt.famPtNm + '(' + famPt.famPtNum + ')';
			document.familyPatientForm.famPtNum.value = famPt.famPtNum;
			document.familyPatientForm.famPtNm.value = famPt.famPtNm;
			document.familyPatientForm.famPtBrdt.value = famPt.famPtBrdt;
			document.familyPatientForm.famRel.value = famPt.famRel;
			
			$('#familyModal').modal('show');
		});
}

// 가족관계 목록을 불러온 데이터를 사용해 셋팅한다.
function setFamilyList(famPt){
	
	let famList = '';
	famPt.forEach(function(fam, idx){
		famList += '<tr class="dropdown">';
		famList += '<td>' + (idx + 1) + '</td>';
		famList += '<td data-toggle="dropdown">' + fam.famPtNm;
		famList += '<ul class="dropdown-menu">';
		famList += '<li><a class="dropdown-item" href="#" onclick="openFamilyModalUpdate(\'' + fam.famPtNum + '\')">수정</a></li>';
		famList += '<li><a class="dropdown-item" href="#" onclick="deleteFamilyAlert(\'' + fam.famPtNum + '\')">삭제</a></li>';
		famList += '</ul>';
		famList += '</td>';
		famList += '<td>' + fam.famPtNum + '</td>';
		famList += '<td>' + fam.famRel + '</td>';
		famList += '</tr>';
	});
	
	familyListBody.innerHTML = famList;
	
}

// 가족관계 삭제 알림창
function deleteFamilyAlert(famPtNum){
	
	Swal.fire({
		title: '가족관계를 삭제하시겠습니까?',
		showDenyButton: true,
		confirmButtonText: '삭제',
		denyButtonText: '취소',
	}).then((result) => {
		if (result.isConfirmed) {
			deleteFamily(famPtNum);
		}
	});
	
}

// 가족관계 삭제
function deleteFamily(famPtNum){
	
	const csrfToken = $('#_csrfToken').val();
	const ptNum = document.patientForm.ptNum.value;
	
	fetch('/hospital/desk/deleteFamily', {
		method: 'post',
		headers: {
			'X-CSRF-TOKEN' : csrfToken,
			'Content-Type' : 'application/json;charset=utf-8'
		},
		body: JSON.stringify({
			'ptNum' : ptNum,
			'famPtNum' : famPtNum
		})
	})
		.then(res => res.text())
		.then(text => {
			if(text == 'FAILED'){
				simpleJustErrorAlert();
				return false;
			}
			
			simpleSuccessAlert('가족관계가 삭제되었습니다.');
			listFamily();
		});
	
}

// 가족관계 모달을 닫으면 내용이 비워진다.
function resetFamilyModal(){
	
	document.familyPatientForm.reset();
	
}

// 풀캘린더 js 시작
// 새 예약 버튼 -> 모달 창 출력
$('#new_reservtaion').on('click', function(){
	newEvent(today(), today());
});

// 예약 목록 클릭시 input date 의 readonly를 닫기 버튼을 눌렀을 때 풀어줌
$('#modalClose').on('click', function(){
	$('input[type="date"]').removeAttr('readonly');
});

// 월 달력 일자 클릭시 날짜 이동
$(document).on('click','.fc-day-number', function(a){
	var date = $(this).data('goto').date;
	
	$('#calendarDay').fullCalendar('gotoDate', new Date(date));
	
	$('#calendarMonth').fullCalendar('destroy'); // 월 달력 삭제
	$('#calendarMonth').fullCalendar(calendar);  // 월 달력 생성
	$('#calendarMonth').fullCalendar('gotoDate', new Date(date.substr(0,7)));
	
	startEvent();
	$('#calendarMonth .fc-right').append("<input type='date' class='fc-state-default fc-corner-left fc-corner-right selectDate'" +
			" value='" + date + "' style='height:30px;' />");
	changeDate();
	breakTime(openTime, closeTime, sbreak ,ebreak);
});



function fullToday(){ //년월일시분초 문자열 생성 2022-12-12
    var d = new Date();
    return d.getFullYear() + "-" 
			+ ((d.getMonth() + 1) > 9 ? (d.getMonth() + 1).toString() : "0" + (d.getMonth() + 1)) + "-" 
			+ (d.getDate() > 9 ? d.getDate().toString() : "0" + d.getDate().toString()) + " " 
			+ (d.getHours() > 9 ? d.getHours().toString() : "0" + d.getHours().toString()) + ":" 
			+ (d.getMinutes() > 9 ? d.getMinutes().toString() : "0" + d.getMinutes().toString());
}

var startEvent = function(){// 달력 2개 초기화 이벤트..ㅠㅠ
	$('#calendarDay').find(".fc-agendaDay-button").trigger("click");// 일 달력 이동버튼 클릭
	$(".fc-viewWeekends-button").attr("hidden",'hidden');	// 주말  보이기 선택 
	$(".fc-month-button").attr("hidden",'hidden');			// 월 달력 이동
	$(".fc-agendaWeek-button").attr("hidden",'hidden');		// 주 달력 이동
	$(".fc-agendaDay-button").attr("hidden",'hidden');		// 일 달력 이동
	$(".fc-listWeek-button").attr("hidden",'hidden');		// 주 메모 이동
	$(".fc-prevYear-button").attr("hidden",'hidden');		// 작년 이동 버튼
	$(".fc-nextYear-button").attr("hidden",'hidden');		// 내년 이동 버튼
	$('.calendar').fullCalendar('refetchEvents');
	
	// custom css 시작
	$('.fc-toolbar').css('padding','0rem');// .fc-toolbar.fc-header-toolbar
	$('.fc-toolbar.fc-header-toolbar').css('padding','0rem');// .fc-toolbar.fc-header-toolbar
	
	$('.col-md-7').css('padding-right','0rem').css('padding-left','1.2rem');
	$('.col-md-5').css('padding-right','1rem').css('padding-left','0.3rem');
	$('.col-md-12').css('padding-left','1.2rem');
	// custom css 끝
}
//달력 2개 초기화 이벤트 끝

startEvent(); // 달력 초기화
changeDate(); // input date 생성 및 변경


// 예약 가능 의사만 표시
$(document).on("click", "#empNum",function(){ dateChange(); });

// 풀캘린더 js 끝


</script>
<script src="/resources/js/searchModule.js"></script>
<script src="/resources/js/deskPatient.js"></script>
<script src="/resources/js/deskRegist.js"></script>
<script src="/resources/js/alertModule.js"></script>